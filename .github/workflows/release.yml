name: Release Thread Bot

on:
  schedule:
    # Create threads: Monday 9am Pakistan time (4am UTC)
    - cron: '0 4 * * 1'
    # Archive threads: Daily at midnight Pakistan time (7pm UTC previous day)
    - cron: '0 19 * * *'
    # Server stats: Daily at 9am Pakistan time (4am UTC)
    - cron: '0 5 * * *'
  workflow_dispatch:
    inputs:
      action:
        description: 'Action to run'
        required: true
        default: 'create'
        type: choice
        options:
          - create
          - archive
          - stats

jobs:
  create-thread:
    if: github.event.schedule == '0 4 * * 1' || github.event.inputs.action == 'create'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install dependencies
        run: npm install discord.js
      
      - name: Run bot
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
        run: node create-thread.js

  archive-threads:
    if: github.event.schedule == '0 19 * * *' || github.event.inputs.action == 'archive'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install dependencies
        run: npm install discord.js
      
      - name: Archive old threads
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
        run: node archive-threads.js

  server-stats:
    if: github.event.schedule == '0 5 * * *' || github.event.inputs.action == 'stats'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install dependencies
        run: npm install discord.js
      
      - name: Post server stats
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
        run: node server-stats.js